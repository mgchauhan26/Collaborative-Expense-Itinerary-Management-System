{% extends 'base.html' %}
{% from 'macros.html' import crud_modal, form_group, card, action_button %}

{% block title %}Create Trip - TripMates{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">
      <i class="fas fa-plane-departure me-2"></i>
      Create New Trip
    </h2>
  </div>

  {% call card(classes="shadow-sm") %}
  <form method="post" id="createTripForm" action="{{ url_for('create_trip') }}" enctype="multipart/form-data"
    novalidate>
    {{ form.csrf_token }}
    {{ form.hidden_tag() }}
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="row g-3">
      <div class="col-md-6">
        {{ form_group(form.title) }}
      </div>
      <div class="col-md-6">
        {{ form_group(form.destination) }}
      </div>

      <div class="col-md-6">
        {{ form_group(form.start_date) }}
      </div>
      <div class="col-md-6">
        {{ form_group(form.end_date) }}
      </div>

      <div class="col-12">
        {{ form_group(form.description) }}
        <small class="text-muted">
          <i class="fas fa-info-circle me-1"></i>
          Add a brief description of your trip (max 500 characters).
        </small>
      </div>

      <div class="col-12">
        {{ form_group(form.group_id) }}
        <small class="text-muted">
          <i class="fas fa-info-circle me-1"></i>
          Link this trip to a group to enable sharing. You can only select groups you are a member of.
        </small>
      </div>

      <div class="col-12">
        <div class="mb-3">
          <label for="cover_image" class="form-label">
            <i class="fas fa-image me-1"></i>
            Cover Image
          </label>
          <div class="input-group">
            {{ form.cover_image(class='form-control' + (' is-invalid' if form.cover_image.errors else ''),
            accept='.jpg,.jpeg,.png',
            id='cover_image') }}
            <small class="text-muted d-block w-100 mt-1">
              <i class="fas fa-info-circle me-1"></i>
              Upload a cover image for your trip (optional, max 16MB, JPG/PNG only)
            </small>
          </div>
          {% for error in form.cover_image.errors %}
          <div class="invalid-feedback d-block">
            <i class="fas fa-exclamation-circle me-1"></i>
            {{ error }}
          </div>
          {% endfor %}
          <div id="imagePreview" class="mt-2 d-none">
            <div class="position-relative">
              <img src="#" alt="Cover preview" class="img-thumbnail" style="max-height: 200px;">
              <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2" id="removeImage">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12">
        <hr>
        <div class="d-flex justify-content-end gap-2">
          <a href="{{ url_for('dashboard') }}" class="btn btn-light">
            <i class="fas fa-times me-1"></i>
            Cancel
          </a>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-1"></i>
            Create Trip
          </button>
        </div>
      </div>
    </div>
  </form>
  {% endcall %}

  {% endblock %}

  {% block scripts %}
  <script src="{{ url_for('static', filename='js/trip-form.js') }}"></script>
  {% endblock %}